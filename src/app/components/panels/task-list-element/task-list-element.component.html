<div (click)="onClick.emit(item)" [ngClass]="{processing: item?.taskStatus === 'PROCESSING', inlined, hovered: isHover}" [routerLink]="!viewExample && !customClickHandler ? ['/task', item?.taskId] : null"
     class="task-item">
    <div class="task-item-header">
        <p-checkbox (click)="$event.stopPropagation()" (ngModelChange)="checkChange.emit($event)" [(ngModel)]="check"
                    [name]="checkGroup" *ngIf="check"
                    [value]="item?.taskId"></p-checkbox>
        <span class="with-label">
            <span class="label">
                <i class="mdi-article"></i>
                <span>Тип</span>
            </span>
            <span [ngClass]="statusColor" class="value">{{item?.modelWireframe?.name}}</span>
        </span>
        <span class="with-label">
            <span class="label">
                <i class="mdi-flag"></i>
                <span>Статус</span>
            </span>
            <span [ngClass]="statusColor" class="value status-caption">{{item | taskStatus}}</span>
        </span>
        <ng-container *ngIf="item?.actualFrom || item?.actualTo">
            <span *ngIf="item?.actualFrom" class="with-label">
                <span class="label">
                    <i class="mdi-today"></i>
                    <span>Запланирована</span>
                </span>
                <span class="value">{{item?.actualFrom | date:'EEEE, dd MMMM yyyy HH:mm' | titlecase}}</span>
            </span>
            <span *ngIf="item?.actualTo && !item?.actualFrom" class="with-label">
                <span class="label">
                    <i class="mdi-today"></i>
                    <span>Срок</span>
                </span>
                <span class="value">{{item?.actualTo | date:'EEEE, dd MMMM yyyy HH:mm' | titlecase}}</span>
            </span>
        </ng-container>
        <ng-container *ngTemplateOutlet="statusTags"></ng-container>
        <div class="stretched"></div>
        <app-employee-label *ngIf="item?.taskStatus !== 'PROCESSING'"
                            [employee]="item?.responsible"></app-employee-label>
        <app-avatar-list *ngIf="item?.taskStatus === 'PROCESSING' && actualWorkLog?.employees" [employees]="actualWorkLog?.employees ?? []"
                         [size]="1.7"></app-avatar-list>
    </div>
    <div [ngClass]="this.item?.modelWireframe?.listViewType" class="task-item-body">
        <ng-container *ngIf="!viewExample">
            <ng-container *ngFor="let field of item?.listItemFields; let i = index; trackBy: trackByField">
                <span *ngIf="i<fieldCountArray.length">{{field?.textRepresentation}}</span>
            </ng-container>
        </ng-container>
        <ng-container *ngIf="viewExample">
            <ng-container *ngFor="let field of fieldCountArray; trackBy: trackByIndex">
                <app-select-field-to-view-button (selectView)="selectFieldToView.emit($event)"
                                                 [fields]="wireframeFieldsList"
                                                 [index]="field"></app-select-field-to-view-button>
            </ng-container>
        </ng-container>
    </div>
    <div *ngIf="item?.lastComment" class="task-item-last-comment">
        <span class="autor">
            {{item?.lastComment?.creator?.fullName}}:
        </span>
        <span class="comment">
            {{item?.lastComment?.simpleText}}
        </span>
    </div>
    <div class="task-item-footer">
        <app-employee-label [employee]="item?.creator" [inline]="true" class="caption size-tiny wt-bold f-color-500"></app-employee-label>
        <span class="caption size-tiny wt-bold f-color-500">
            {{item?.created | date:'EEEE, dd MMMM yyyy HH:mm' | titlecase}}
        </span>
    </div>
</div>


<!--Дополнительная информация о статусе и тегах задачи-->
<ng-template #statusTags>
    <div class="tags-view">
        <div *ngFor="let tag of item?.tags|slice:0:2; trackBy: trackByTag" [style.background-color]="tag.color"
             class="tags-view-item small">{{tag.name}}</div>
        <div (mouseenter)="tagsPreviewShow($event)" (mouseleave)="tagsPreviewHide()" *ngIf="isMoreTwoTags"
             class="tags-view-item small">{{remainingNumberOfTags}}+
        </div>
    </div>
</ng-template>


<p-overlayPanel #tagsPreview [appendTo]="'body'" hideTransitionOptions="0ms" showTransitionOptions="0ms">
    <div class="tags-view wrap max">
        <div *ngFor="let tag of item?.tags|slice:2; trackBy: trackByTag" [style.background-color]="tag.color"
             class="tags-view-item">{{tag.name}}</div>
    </div>
</p-overlayPanel>
