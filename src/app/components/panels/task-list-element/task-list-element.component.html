<ng-container *ngIf="!isLoading" [ngSwitch]="item?.modelWireframe?.listViewType??''">

    <div (click)="onClick.emit(item)" *ngSwitchCase="'SIMPLE'"
         [ngClass]="itemClass" [routerLink]="!viewExample && !customClickHandler ? ['/task',item?.taskId] : null"
         class="task-item simple-layout">
        <ng-container *ngIf="!viewExample">
            <ng-container *ngTemplateOutlet="statusTags"></ng-container>
            <ng-container *ngTemplateOutlet="checkbox"></ng-container>
        </ng-container>
        <app-task-field-view
                *ngIf="!viewExample"
                [item]="taskService.gettingFieldValueById(item, taskService.gettingFieldIdByIndex(item?.modelWireframe, 1))"
                class="main-caption"></app-task-field-view>
        <app-select-field-to-view-button (selectView)="selectFieldToView.emit($event)"
                                         *ngIf="viewExample"
                                         [fields]="wireframeFieldsList"
                                         [index]="1"
                                         class="main-caption"></app-select-field-to-view-button>
        <ng-component *ngTemplateOutlet="metaInfo"></ng-component>
    </div>

    <div (click)="onClick.emit(item)" *ngSwitchCase="'COMPOSITE'"
         [ngClass]="itemClass" [routerLink]="!viewExample && !customClickHandler ? ['/task',item?.taskId] : null"
         class="task-item composite-layout">
        <ng-container *ngIf="!viewExample">
            <ng-container *ngTemplateOutlet="statusTags"></ng-container>
            <ng-container *ngTemplateOutlet="checkbox"></ng-container>
        </ng-container>
        <app-task-field-view
                *ngIf="!viewExample"
                [item]="taskService.gettingFieldValueById(item, taskService.gettingFieldIdByIndex(item?.modelWireframe, 1))"
                class="main-caption"></app-task-field-view>
        <app-select-field-to-view-button (selectView)="selectFieldToView.emit($event)"
                                         *ngIf="viewExample"
                                         [fields]="wireframeFieldsList"
                                         [index]="1"
                                         class="main-caption"></app-select-field-to-view-button>
        <app-task-field-view
                *ngIf="!viewExample"
                [item]="taskService.gettingFieldValueById(item, taskService.gettingFieldIdByIndex(item?.modelWireframe, 2))"
                class="additional-caption"></app-task-field-view>
        <app-select-field-to-view-button (selectView)="selectFieldToView.emit($event)"
                                         *ngIf="viewExample"
                                         [fields]="wireframeFieldsList"
                                         [index]="2"
                                         class="additional-caption"></app-select-field-to-view-button>
        <ng-component *ngTemplateOutlet="metaInfo"></ng-component>
    </div>

    <div (click)="onClick.emit(item)" *ngSwitchCase="'DETAILED'"
         [ngClass]="itemClass" [routerLink]="!viewExample && !customClickHandler ? ['/task',item?.taskId] : null"
         class="task-item detailed-layout">
        <ng-container *ngIf="!viewExample">
            <ng-container *ngTemplateOutlet="statusTags"></ng-container>
            <ng-container *ngTemplateOutlet="checkbox"></ng-container>
        </ng-container>
        <app-task-field-view
                *ngIf="!viewExample"
                [item]="taskService.gettingFieldValueById(item, taskService.gettingFieldIdByIndex(item?.modelWireframe, 1))"
                class="main-caption"></app-task-field-view>
        <app-select-field-to-view-button (selectView)="selectFieldToView.emit($event)"
                                         *ngIf="viewExample"
                                         [fields]="wireframeFieldsList"
                                         [index]="1"
                                         class="main-caption"></app-select-field-to-view-button>
        <span class="splitter">-</span>
        <app-task-field-view
                *ngIf="!viewExample"
                [item]="taskService.gettingFieldValueById(item, taskService.gettingFieldIdByIndex(item?.modelWireframe, 2))"
                class="second-caption"></app-task-field-view>
        <app-select-field-to-view-button (selectView)="selectFieldToView.emit($event)"
                                         *ngIf="viewExample"
                                         [fields]="wireframeFieldsList"
                                         [index]="2"
                                         class="second-caption"></app-select-field-to-view-button>
        <app-task-field-view
                *ngIf="!viewExample"
                [item]="taskService.gettingFieldValueById(item, taskService.gettingFieldIdByIndex(item?.modelWireframe, 3))"
                class="additional-caption"></app-task-field-view>
        <app-select-field-to-view-button (selectView)="selectFieldToView.emit($event)"
                                         *ngIf="viewExample"
                                         [fields]="wireframeFieldsList"
                                         [index]="3"
                                         class="additional-caption"></app-select-field-to-view-button>
        <ng-component *ngTemplateOutlet="metaInfo"></ng-component>
    </div>

</ng-container>

<ng-container *ngIf="isLoading">
    <div class="task-item detailed-layout">
        <p-skeleton class="main-caption" width="5rem" height=".9rem"></p-skeleton>
        <span class="splitter">-</span>
        <p-skeleton class="second-caption" width="25%" height=".9rem"></p-skeleton>
        <div class="additional-caption" [style]="{display:'flex', flexDirection:'column', gap:'.3rem'}">
            <p-skeleton width="70%" height=".8rem"></p-skeleton>
            <p-skeleton width="56%" height=".8rem"></p-skeleton>
            <p-skeleton width="44%" height=".8rem"></p-skeleton>
        </div>
        <p-skeleton class="meta-info" width="5rem" height="2rem"></p-skeleton>
    </div>
</ng-container>

<!--Элемент чекбокс для выбора задачи-->
<ng-template #checkbox>
    <div (click)="$event.stopPropagation()" *ngIf="check" class="checkbox-wrapper">
        <p-checkbox (ngModelChange)="checkChange.emit($event)" [(ngModel)]="check" [name]="checkGroup"
                    [value]="item?.taskId"></p-checkbox>
    </div>
</ng-template>

<!--Дополнительная информация о статусе и тегах задачи-->
<ng-template #statusTags>
    <div class="status-tags-panel">
        <div class="tags-view">
            <div class="tags-view-item small" *ngFor="let tag of item?.tags|slice:0:2" [style.background-color]="tag.color">{{tag.name}}</div>
            <div class="tags-view-item small" *ngIf="isMoreTwoTags" (mouseenter)="tagsPreviewShow($event)" (mouseleave)="tagsPreviewHide()">{{remainingNumberOfTags}}+</div>
        </div>
        <span class="status" [ngClass]="statusClass">
            {{item | taskStatus}}
        </span>
    </div>
</ng-template>

<!--Информация о времени создания и авторе задачи-->
<ng-template #metaInfo>
    <div class="meta-info flexed stretched column hend spbtw p5">
        <div class="flexed gap5 hcenter">
            <app-employee-label *ngIf="!viewExample" [employee]="item?.creator" [size]="1.8"></app-employee-label>
            <app-employee-label *ngIf="viewExample" [employee]="{login:'Сотрудник'}" [size]="1.8"></app-employee-label>
        </div>
        <span class="caption-secondary one-line">{{item?.created | date:fullDate ? "dd MMM yyyy HH:mm" : "HH:mm"}}</span>
    </div>
</ng-template>

<p-overlayPanel #tagsPreview [appendTo]="'body'" showTransitionOptions="0ms" hideTransitionOptions="0ms">
    <div class="tags-view wrap max">
        <div class="tags-view-item" *ngFor="let tag of item?.tags|slice:2"
             [style.background-color]="tag.color">{{tag.name}}</div>
    </div>
</p-overlayPanel>
