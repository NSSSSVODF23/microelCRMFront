<div *ngIf="commutator && commutator.additionalInfo && commutator.additionalInfo.systemInfo; else noinfo"
     class="flex flex-column gap-2 p-3 bg-white border-round-lg border-bluegray-100 border-1">
    <ng-container *ngIf="commutator.additionalInfo">
        <div class="flex gap-1 align-items-center text-xs text-bluegray-300 font-bold justify-content-end">
            <span>
                Обновлен:
            </span>
            <app-time-elapsed [startTime]="commutator.additionalInfo.systemInfo?.lastUpdate"></app-time-elapsed>
            <app-tiny-button (onClick)="refresh()" [disabled]="isUpdating" icon="refresh"></app-tiny-button>
        </div>
        <div class="flex gap-3">
            <div class="flex flex-column text-bluegray-400">
                <span>
                    {{commutator.additionalInfo.systemInfo?.device}} {{commutator.additionalInfo.systemInfo?.hwVersion}}
                </span>
                <span class="text-sm">
                    FW: {{commutator.additionalInfo.systemInfo?.fwVersion}}
                </span>
                <span class="text-xs font-bold text-bluegray-300">
                    <span>Аптайм</span>
                    <app-time-elapsed [startTime]="uptime"></app-time-elapsed>
                </span>
            </div>
            <div *ngIf="commutator.additionalInfo" class="port-grille">
                <div (click)="selectPort(port)" *ngFor="let port of commutator.additionalInfo.ports ?? []"
                     [class]="'w-3rem h-2rem border-round-lg cursor-pointer user-select-none flex flex-column align-items-center justify-content-center '+portStatusStyle(port)"
                     [ngClass]="{'border-2 border-primary-400': (selectPortChange$|async)?.portInfoId === port.portInfoId}">
                    <span class="text-white text-xs font-bold">{{port.name}}</span>
                    <span class="text-white text-xs font-bold">{{portSpeedName(port)}}</span>
                </div>
            </div>
        </div>
        <div *ngIf="selectPortChange$|async as selectedPort">
            <p-table [value]="(fdbTable$|async) ?? []" [scrollable]="true" scrollHeight="30rem" [loading]="fdbTableLoadingState === 'LOADING'"
                     styleClass="p-datatable-sm border-1 border-round-md border-bluegray-100 overflow-hidden" [hidden]="fdbTableLoadingState == 'EMPTY' || fdbTableLoadingState == 'ERROR'">
                <ng-template pTemplate="header">
                    <tr>
                        <th>MAC-адрес</th>
                        <th>VID</th>
                        <th>Имя vlan</th>
                        <th>Динамический</th>
                        <th>Сессия</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-item>
                    <tr>
                        <td>{{item.mac}}</td>
                        <td>{{item.vid}}</td>
                        <td>{{item.vlanName}}</td>
                        <td>{{item.dynamic}}</td>
                        <td>{{item.dhcpBinding?.authName}}</td>
                    </tr>
                </ng-template>
            </p-table>
            <ng-container [ngSwitch]="fdbTableLoadingState">
                <div class="flex flex-column align-items-center justify-content-center p-3 text-bluegray-300 font-bold" *ngSwitchCase="'EMPTY'">
                    <span class="mds-dns"></span>
                    <span>Таблица MAC-адресов пуста</span>
                </div>
                <div class="flex flex-column align-items-center justify-content-center p-3 text-red-400 font-bold" *ngSwitchCase="'ERROR'">
                    <span class="mds-error"></span>
                    <span>Ошибка загрузки таблицы MAC-адресов</span>
                </div>
            </ng-container>
        </div>
    </ng-container>
</div>

<ng-template #noinfo>
    <div class="flex flex-column align-items-center text-bluegray-300 font-bold text-sm">
        <span class="mds-visibility_off"></span>
        <span>Нет информации</span>
    </div>
</ng-template>
