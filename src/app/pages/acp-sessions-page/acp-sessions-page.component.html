<div appExtendPageHeight class="flex justify-content-center">
    <div [style]="{marginBottom: '1rem'}" class="responsive-wrapper flex gap-3">
        <app-main-menu-panel></app-main-menu-panel>
        <ng-container *ngIf="lastBindingsPage$ | async as lastBindingsPage; else loading">
            <div class="flex flex-column gap-3 flex-grow-1 panel p-3">
                <div class="flex align-items-center gap-2 text-bluegray-400 text-lg font-bold">
                    <span class="mdi-router"></span><span>Сессии абон. оборудования</span>
                </div>
                <div class="flex flex-column flex-grow-1" @flowInChild>
                    <ng-container *ngFor="let binding of lastBindingsPage.content; trackBy: trackByDhcpBinding"
                                  [ngTemplateOutletContext]="{binding: binding}"
                                  [ngTemplateOutlet]="sessionItem"></ng-container>
                </div>
                <p-paginator (onPageChange)="changeLastBindingsPage.next($event.page)"
                             [first]="lastBindingsPage.number * 15"
                             [rows]="15"
                             [totalRecords]="lastBindingsPage.totalElements"></p-paginator>
            </div>
            <div [formGroup]="lastBindingsFilterForm"
                 class="flex flex-column p-3 gap-3 align-items-end h-min panel sticky" [style.top]="'calc(var(--top-panel-height) + 1.5rem)'">
                <span class="text-bluegray-400 text-lg font-bold flex align-items-center align-self-start"><span class="mdi-filter_alt"></span> Фильтры</span>
                <div [formGroup]="lastBindingsFilterForm" class="flex flex-column gap-3">
                    <input [size]="14" formControlName="macaddr" pInputText placeholder="MAC-адрес" type="text"/>
                    <input [size]="8" formControlName="login" pInputText placeholder="Логин" type="text"/>
                    <app-acp-house-input formControlName="buildingId"></app-acp-house-input>
                    <app-ip-input formControlName="ip"></app-ip-input>
                    <p-inputNumber [max]="4096" [size]="4" formControlName="vlan"
                                   placeholder="VLAN"></p-inputNumber>
                </div>
<!--                <p-toggleButton [disabled]="isLoadingLastBindings" formControlName="state" offIcon="mdi-cancel"-->
<!--                                offLabel="Не в сети" onIcon="mdi-check_circle"-->
<!--                                onLabel="В сети"></p-toggleButton>-->
                <p-button (onClick)="lastBindingsFilterForm.reset({state:true})" icon="mdi-filter_alt_off"
                          label="Сбросить"
                          styleClass="p-button-secondary p-button-text"></p-button>
                <div class="text-primary-400 font-bold">
                    Найдено: {{lastBindingsPage.totalElements}} {{lastBindingsPage.totalElements | decline:'сессия':'сессии':'сессий'}}
                </div>
            </div>
        </ng-container>
    </div>
</div>

<ng-template #sessionItem let-binding="binding">
    <div
         class="flex flex-column p-3 gap-1 cursor-pointer hover:bg-primary-50
          hover:text-primary-400 split-line transition-ease-in-out transition-duration-150">
        <div class="flex gap-2">
            <span class="font-bold">{{binding.macaddr}}</span>
            <span *ngIf="binding.authName">{{binding.authName}}</span>
            <div [style.max-width]="'15rem'" appTicker class="white-space-nowrap overflow-hidden">
                <ng-container *ngIf="binding.dhcpClient">
                    {{binding.dhcpClient}}
                </ng-container>
                <ng-container *ngIf="binding.dhcpHostname">
                    {{binding.dhcpHostname}}
                </ng-container>
            </div>
            <span class="flex align-items-center font-bold text-sm gap-1" [ngClass]="{'text-primary-400': binding.onlineStatus ==='ONLINE'}">
                <span>{{binding.onlineStatus === 'ONLINE' ? 'В сети' : 'Не в сети'}}</span>
                <app-time-elapsed [startTime]="binding.leaseStart"
                                  type="short"></app-time-elapsed>
            </span>
        </div>
        <div class="flex gap-2">
            <span>
                <ng-container [ngSwitch]="binding.isAuth">
                    <span *ngSwitchCase="false" class="text-bluegray-300 white-space-nowrap">Не авторизован</span>
                    <span *ngSwitchCase="true" class="text-green-400">Авторизован</span>
                </ng-container>
            </span>
            <span>{{binding.streetName}} {{binding.houseNum}}</span>
            <span>{{binding.ipaddr}}</span>
            <span *ngIf="binding.lastConnectionLocation">{{binding.lastConnectionLocation.commutatorName}} {{binding.lastConnectionLocation.portName}} порт</span>
        </div>
    </div>
</ng-template>

<ng-template #loading>
    <div class="flex align-items-center justify-content-center flex-grow-1 py-5 panel">
        <p-progressSpinner class="custom-spinner custom-spinner-gray custom-spinner-8xl"
                           strokeWidth="1"></p-progressSpinner>
    </div>
</ng-template>
