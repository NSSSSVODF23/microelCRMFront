<div appExtendPageHeight class="flexed vcenter">
    <div class="responsive-wrapper flexed gap10">
        <app-main-menu-panel></app-main-menu-panel>
        <div class="flexed column stretched gap10 panel overflow" [style.margin-bottom]="'1rem'">
            <ng-container *ngTemplateOutlet="tabview"></ng-container>
        </div>
    </div>
</div>

<ng-template #tabview>
    <p-tabView>
        <p-tabPanel header="Шаблоны" leftIcon="mdi-list_alt">
            <div class="flexed gap10" [style.padding-bottom]="'1rem'">
                <p-button [routerLink]="['constructor']" styleClass="p-button-outlined p-button-success" icon="mdi-add" label="Создать"></p-button>
                <p-toggleButton onLabel="Скрыть удаленные" offLabel="Показать удаленные" [formControl]="deletedTemplatesSwitcher"></p-toggleButton>
            </div>
            <ng-container [ngSwitch]="templateLoadingState">
                <ng-container *ngSwitchCase="'LOADING'">
                    <div class="flexed hcenter vcenter p20">
                        <p-progressSpinner class="primary-spinner" strokeWidth="1"></p-progressSpinner>
                    </div>
                </ng-container>
                <ng-container *ngSwitchCase="'READY'">
                    <ng-container *ngFor="let item of templateItems; trackBy: trackByTemplate">
                        <ng-container *ngTemplateOutlet="templateItem; context:{$implicit:item}"></ng-container>
                    </ng-container>
                </ng-container>
                <ng-container *ngSwitchCase="'ERROR'">
                    <div class="flexed hcenter vcenter p20 caption-common-error">
                        <i class="mdi-alert"></i>
                        <span>Ошибка загрузки шаблонов</span>
                    </div>
                </ng-container>
                <ng-container *ngSwitchCase="'EMPTY'">
                    <div class="flexed hcenter vcenter p20 caption-common-message">
                        <i class="mdi-alert"></i>
                        <span>Нет шаблонов</span>
                    </div>
                </ng-container>
            </ng-container>

        </p-tabPanel>
        <p-tabPanel header="Теги" leftIcon="mdi-local_offer">
            <div class="flexed gap10" [style.padding-bottom]="'1rem'">
                <p-button (click)="openCreateTagDialog()" styleClass="p-button-outlined p-button-success" icon="mdi-add" label="Создать"></p-button>
                <p-toggleButton onLabel="Скрыть удаленные" offLabel="Показать удаленные" [formControl]="deletedTagsSwitcher"></p-toggleButton>
            </div>
            <ng-container [ngSwitch]="tagLoadingState">
                <ng-container *ngSwitchCase="'LOADING'">
                    <div class="flexed hcenter vcenter p20">
                        <p-progressSpinner class="primary-spinner" strokeWidth="1"></p-progressSpinner>
                    </div>
                </ng-container>
                <ng-container *ngSwitchCase="'READY'">
                    <app-task-tag-list-item *ngFor="let tag of availableTags; trackBy: trackByTag" [tag]="tag"></app-task-tag-list-item>
                </ng-container>
                <ng-container *ngSwitchCase="'ERROR'">
                    <div class="flexed hcenter vcenter p20 caption-common-error">
                        <i class="mdi-alert"></i>
                        <span>Ошибка загрузки тегов</span>
                    </div>
                </ng-container>
                <ng-container *ngSwitchCase="'EMPTY'">
                    <div class="flexed hcenter vcenter p20 caption-common-message">
                        <i class="mdi-alert"></i>
                        <span>Нет тегов</span>
                    </div>
                </ng-container>
            </ng-container>
        </p-tabPanel>
    </p-tabView>
</ng-template>

<ng-template #templateItem let-item>
    <div class="template-item flexed hcenter gap5">
        <div class="flexed column gap5 stretched">
            <span class="flexed hcenter caption-main stretched hcenter gap3" [style.opacity]="item.deleted ? 0.5 : 1">
                <i class="mdi-not_interested" *ngIf="item.deleted"></i>
                <span>
                    {{item.name}}
                </span>
                <span class="caption-tiny indent1">
                    Создана: {{item.created|date:"dd MMMM yyyy HH:mm"}}
                </span>
            </span>
            <span *ngIf="item.description" class="caption-secondary">
                {{item.description}}
            </span>
        </div>
        <p-button label="Редактировать" [routerLink]="['constructor']" [disabled]="item.deleted" icon="mdi-edit"
                  [queryParams]="{editingId:item.wireframeId}" styleClass="p-button-warning p-button-text">
        </p-button>
        <p-button (onClick)="confirmDeleteWireframe($event, item.wireframeId)"
                  styleClass="p-button-danger p-button-text" icon="mdi-delete" label="Удалить"
                  [disabled]="item.deleted"></p-button>
    </div>
</ng-template>

<p-dialog [(visible)]="showCreateTagDialog" [breakpoints]="{'960px': '75vw'}" [draggable]="false" [modal]="true" [resizable]="false"
          [style]="{width: 'max-content'}" header="Создать тег">
    <div class="flexed column gap10 p3">
        <div class="flexed hcenter gap15">
            <input [(ngModel)]="tagNameToCreate" pInputText placeholder="Введите название тега" type="text"/>
            <span class="flexed hcenter gap3">
                <span>Фон тега</span>
                <p-colorPicker [(ngModel)]="tagColorToCreate" appendTo="body"></p-colorPicker>
            </span>
        </div>
        <app-button (onClick)="createTag()" [disabled]="!tagNameToCreate && !tagColorToCreate" [loading]="isTagCreating"
                    icon="check" label="Создать"></app-button>
    </div>
</p-dialog>
